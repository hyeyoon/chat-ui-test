@import "tailwindcss";

:root {
  /* Safe area insets for devices with notches */
  --safe-area-inset-top: env(safe-area-inset-top, 0px);
  --safe-area-inset-right: env(safe-area-inset-right, 0px);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-inset-left: env(safe-area-inset-left, 0px);
  
  /* VirtualKeyboard API support */
  --keyboard-inset-height: env(keyboard-inset-height, 0px);
  
  /* Dynamic viewport height - 2024 modern solution */
  --vh: 100vh;
  --dvh: 100dvh;
}

/* Modern viewport units with fallback */
html, body, #root {
  margin: 0;
  padding: 0;
  width: 100%;
  
  /* 2024 solution: dvh with 100vh fallback */
  height: 100vh;
  height: 100dvh;
  
  /* Prevent bounce scrolling on iOS */
  overscroll-behavior: none;
  
  /* Prevent text size adjust on orientation change */
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

* {
  box-sizing: border-box;
}

/* Chat app layout using CSS Grid - 2024 VirtualKeyboard API approach */
body {
  display: flex;
  flex-direction: column;
  /* Remove grid approach for more reliable behavior */
}

#root {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
  
  /* Dynamic height based on keyboard state */
  height: 100vh;
  height: 100dvh;
}

/* iOS Safari specific fixes */
@supports (-webkit-touch-callout: none) {
  /* Prevent zoom on input focus */
  input, textarea, select {
    font-size: 16px;
    -webkit-appearance: none;
  }
  
  /* Disable text selection callouts globally */
  * {
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
  }
  
  /* Re-enable text selection for inputs */
  input, textarea {
    -webkit-touch-callout: default;
    -webkit-user-select: text;
    user-select: text;
  }
}

/* Modern CSS environment variable support */
@supports (padding: env(safe-area-inset-top)) {
  .safe-area {
    padding-top: env(safe-area-inset-top);
    padding-right: env(safe-area-inset-right);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
  }
}

/* VirtualKeyboard API support detection */
@supports (height: env(keyboard-inset-height)) {
  .keyboard-aware {
    margin-bottom: env(keyboard-inset-height, 0px);
  }
}

/* iOS Safari specific blank space fixes */
@supports (-webkit-touch-callout: none) {
  /* Fix for iOS Safari viewport issues */
  body {
    position: relative;
    overflow-x: hidden;
  }
  
  /* Prevent iOS Safari from shifting layout */
  #root {
    position: relative;
    overflow: hidden;
  }
  
  /* iOS keyboard specific fixes */
  .keyboard-aware {
    /* Ensure input stays at bottom on iOS */
    position: sticky;
    bottom: 0;
    z-index: 1000;
  }
}

/* Modern input styling to prevent zoom on iOS */
input, textarea {
  font-size: max(16px, 1rem);
  background-color: white;
  border-radius: 0.5rem;
  border: 1px solid #e5e7eb;
  padding: 0.75rem;
  outline: none;
  transition: border-color 0.15s ease-in-out;
}

input:focus, textarea:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* iOS keyboard active state - Aggressive blank space prevention */
.ios-keyboard-active {
  /* Ensure no extra space can appear */
  height: 100% !important;
  max-height: 100% !important;
  overflow: hidden !important;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
}

.ios-keyboard-active #root {
  height: 100% !important;
  max-height: 100% !important;
  overflow: hidden !important;
  position: relative !important;
}

/* Prevent any scrolling during iOS keyboard state */
.ios-keyboard-active * {
  /* Prevent any element from creating scroll */
  overscroll-behavior: none !important;
}

/* Ensure input area stays visible on iOS */
.ios-keyboard-active footer {
  position: absolute !important;
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
  z-index: 9999 !important;
}